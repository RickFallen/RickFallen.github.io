<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="PHP,Laravel,artisan,Integration/Image," />








  <link rel="shortcut icon" type="image/x-icon" href="/res/img/favicon.ico?v=5.0.1" />






<meta name="description" content="本人因公司的需要.学习PHP的Laravel框架.本博文为学习笔记.本博文中包含有 Laravel安装配置环境部署,路由,控制器,视图,模型,MVC ,数据库,请求,Session,表单研制,中间件,哈希,辅助函数,以及图片处理库Integration/Image的使用.artisan常用命令等内容.">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP学习笔记-Laravel框架">
<meta property="og:url" content="http://comtu.github.com/2015/10/10/PHP_Laravel.html">
<meta property="og:site_name" content="Comtu">
<meta property="og:description" content="本人因公司的需要.学习PHP的Laravel框架.本博文为学习笔记.本博文中包含有 Laravel安装配置环境部署,路由,控制器,视图,模型,MVC ,数据库,请求,Session,表单研制,中间件,哈希,辅助函数,以及图片处理库Integration/Image的使用.artisan常用命令等内容.">
<meta property="og:updated_time" content="2016-09-30T03:14:34.708Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHP学习笔记-Laravel框架">
<meta name="twitter:description" content="本人因公司的需要.学习PHP的Laravel框架.本博文为学习笔记.本博文中包含有 Laravel安装配置环境部署,路由,控制器,视图,模型,MVC ,数据库,请求,Session,表单研制,中间件,哈希,辅助函数,以及图片处理库Integration/Image的使用.artisan常用命令等内容.">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 9414502,
      author: 'Comtu'
    }
  };
</script>




  <link rel="canonical" href="http://comtu.github.com/2015/10/10/PHP_Laravel.html"/>

  <title> PHP学习笔记-Laravel框架 | Comtu </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?e0d9a75a7e53b54cd1e6649facd5906e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Comtu</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                PHP学习笔记-Laravel框架
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-10-10T00:00:00+08:00" content="2015-10-10">
              2015-10-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/10/10/PHP_Laravel.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="/2015/10/10/PHP_Laravel.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/10/10/PHP_Laravel.html" class="leancloud_visitors" data-flag-title="PHP学习笔记-Laravel框架">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本人因公司的需要.学习PHP的Laravel框架.本博文为学习笔记.<br>本博文中包含有 <code>Laravel安装配置环境部署</code>,<code>路由</code>,<code>控制器</code>,<code>视图</code>,<code>模型</code>,<code>MVC</code> ,<code>数据库</code>,<code>请求</code>,<code>Session</code>,<code>表单研制</code>,<br><code>中间件</code>,<code>哈希</code>,<code>辅助函数</code>,以及<code>图片处理库Integration/Image</code>的使用.<code>artisan</code>常用命令等内容.   </p>
<a id="more"></a>
<p>目录:</p>
<ul>
<li><a href="#安装Laravel">安装Laravel</a></li>
<li><a href="#Laravel目录结构">Laravel目录结构</a></li>
<li><a href="#路由">路由</a></li>
<li><a href="#控制器(Controller">控制器(Controller)</a>)</li>
<li><a href="#视图(Views">视图(Views)</a>)</li>
<li><a href="#模型(model">模型(model)</a>)</li>
<li><a href="#环境与部署">环境与部署</a></li>
<li><a href="#数据库">数据库</a></li>
<li><a href="#请求">请求</a></li>
<li><a href="#Session">Session</a></li>
<li><a href="#表单验证">表单验证</a></li>
<li><a href="#中间件">中间件</a></li>
<li><a href="#哈希">哈希</a></li>
<li><a href="#辅助函数">辅助函数</a></li>
<li><a href="#图片处理库Integration/Image">在 Laravel 中使用图片处理库 Integration/Image</a></li>
<li><a href="#我遇到的错误">我遇到的错误</a></li>
<li><a href="#artisan命令">artisan命令</a></li>
<li><a href="#Demo">Demo</a></li>
</ul>
<h1 id="安装Laravel"><a href="#安装Laravel" class="headerlink" title="安装Laravel"></a><a id="安装Laravel"></a>安装Laravel</h1><pre><code>1.1.下载安装PHP

    http://windows.php.net/download/

    IDE (https://www.jetbrains.com/phpstorm/)

    本人使用的PHP版本为:php-5.5.28-nts
    Laravel框架要求PHP 版本 &gt;= 5.4

1.2.安装Composer 

    Composer  
    官网: https://getcomposer.org/
    GitHub: https://github.com/composer/composer
    中文: http://www.phpcomposer.com/ 中国镜像

    Composert官方下载地址: https://getcomposer.org/Composer-Setup.exe

    如果出现如下安装错误:

        Some settings on your machine make Composer unable to work properly.
        Make sure that you fix the issues listed below and run this script again:
        The openssl extension is missing, which means that secure HTTPS transfers are impossible.
        If possible you should enable it or recompile php with --with-openssl

        缺失openssl扩展

        处理方式: 
            找到php目录下的php.ini文件(如果没有则把php.ini-development拷贝重命名为php.ini)
            用编辑器打开 php.ini 文件，修改以下配置： 
            去掉 extension=php_mbstring.dll 前面的分号（888 行左右） 
            去掉 extension=php_openssl.dll 前面的分号（893 行左右） 
            去掉 extension_dir = &quot;ext&quot; 前面的分号（736 行左右）
        然后重试即可.安装完全成后使用cmd输入composer显示如下内容表示安装成功.

    C:\Users\comtu&gt;composer
       ______
      / ____/___  ____ ___  ____  ____  ________  _____
     / /   / __ \/ __ `__ \/ __ \/ __ \/ ___/ _ \/ ___/
    / /___/ /_/ / / / / / / /_/ / /_/ (__  )  __/ /
    \____/\____/_/ /_/ /_/ .___/\____/____/\___/_/
                /_/

    ....省略.....

1.3.在项目中创建 Composer 

    使用cmd定位到项目目录下.如:
        E:\ComTu_Design\PHP\Apache2.2\htdocs\firstPHPStorm&gt;

    使用命令:
        cmd(或者使用PHPStorm的Terminal本人使用的IDE就是PHPStorm)    

        composer create-project laravel/laravel --prefer-dist my_laravel

        回车后会自动下载laravel框架.下载目录生成在firstPHPStorm目录下.
            laravel/laravel 指下载laravel目录下的laravel
            --prefer-dist下载的文件为压缩过的.
            my_laravel 为安装到的文件目录名(自定义).

        如果没有代理下载速度就呵呵了.(本人大概花费15分钟左右时间.)
        最后提示如下内容表示下载成功:
            Application key [xxxxxxxxxxxxxxxxxxxx] set successfully. 

    一键安装包
        故有了一键安装包.rar里面的内容就是通过命令下载下来的文件.免去了再龟速的下载.

        Laravel一键安装包下载地址: http://www.golaravel.com/download/

1.4.测试运行Laravel

测试运行方式1:

    cmd(或者使用PHPStorm的Terminal本人使用的IDE就是PHPStorm)

    php -S localhost:80 -t my_laravel\public

    提示出现:
        PHP 5.5.28 Development Server started at Sat Oct 10 10:20:28 2015
        Listening on http://localhost:80
        Document root is E:\ComTu_Design\PHP\Apache2.2\htdocs\firstPHPStorm\my_laravel\public
        Press Ctrl-C to quit.

    打开浏览器:
    地址栏输入:localhost
    界面中显示出&quot;Laravel 5&quot;大字表示运行成功.

    但如果你的是使用linux或者其它系统.如果出现浏览器显示出白屏或者其它内容.则可能是因为有两个文件夹的权限的原因
    需要为 my_laravel/storage (日志,session,等目录)  与 my_laravel/vendor (Composer下载的支持库,或者自己的第三方库目录)
    有写入的权限

    Linux设置对应的权限命令如下:

        chown -R apache:apache /var/www/my_laravel/storage
        chown -R apache:apache /var/www/my_laravel/vendor


测试运行方式2(PHP版本5.4之后的版本):

    artisan 的 serve 命令还支持两个参数：

    host 设置主机地址
    port 设置 web server 监听的端口号
    例如：php artisan serve --port=8888


    cmd 定位目录到my_laravel 输入 php artisan serve (PHP5.4之后开始支持内置web Server 同时Laravel也支持)
    E:\ComTu_Design\PHP\Apache2.2\htdocs\firstPHPStorm\my_laravel&gt;php artisan serve 回车(默认8000接口可指定)
    Laravel development server started on http://localhost:8000/ 提示

    打开浏览器，在地址栏输入 localhost:8000 于方式1运行出相同的效果.

    如你电脑上有运行Apache 并且端口也是8000那么会出现如下提示,需要关闭Apache或者指定其它接口后再试.
    [Sat Oct 10 10:39:21 2015] Failed to listen on localhost:8000 
    (reason: 以一种访问权限不允许的方式做了一个访问套接字的尝试。)
</code></pre><h1 id="Laravel目录结构"><a href="#Laravel目录结构" class="headerlink" title="Laravel目录结构"></a><a id="Laravel目录结构"></a>Laravel目录结构</h1><pre><code>本学习笔记使用到的文件目录

my_laravel
    |--&gt;app
    |    |---&gt;Http 
    |    |     |----&gt;Controllers 控制器目录
    |    |     |       |-----&gt; 控制器文件
    |    |     |----&gt;Middleware
    |    |     |       |-----&gt; 中间件文件
    |    |     |----&gt;routes.php 路由配置文件
    |    |     |----&gt;Kernel.php 中间件配置文件
    |    |---&gt; 根目录Model默认目录
    |--&gt;bootstrap
    |--&gt;config  配置文件
    |    |--&gt; app.php
    |    |--&gt; database.php
    |    |--&gt; ....
    |--&gt;database 数据库
    |--&gt;public 对外开放目录
    |--&gt;resources
    |    |---&gt;views 视图View目录
    |          |----&gt;xxxx.blade.php 视图文件
    |          |----&gt;errors 目录
    |                  |-----&gt; 503.blade.php 文件当artisan命令使用 php artisan down 时会网站全部连接转向此文件.
    |--&gt;storage 日志,session等缓存目录
    |--&gt;tests 
    |--&gt;vendor 自己的第三方库目录与Composer下载的支持库
    |    |---&gt;laravel 框架目录
    |    |---&gt;intervention 图片处理库,需要下载
    |--&gt;.env 文件 环境配置文件.
    |--&gt;Composer.json 环境库配置文件 
</code></pre><h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a><a id="路由"></a>路由</h1><pre><code>路由作用是宏观的分发和限制请求

http://laravel-china.org/docs/5.0/routing 中文文档

http://laravel.com/docs/5.0/routing 原版文档
http://laravel.com/docs/5.1/routing 原版文档

3.1 配置基本路由
    文件目录:my_laravel/app/Http/routes.php    

    选择get/post/any 等等
        一般get是向服务器要数据
        post是向服务器发数据
        any就是通过全部请求类型

    //get
        Route::get(&apos;/&apos;,&apos;WelcomeController@index&apos;);
        //意思是如果通过get访问/域名就交给WelcomeController控制器的index方法进行处理.

        //通过 http://localhost/home 访问.可进入到登录页面
        Route::get(&apos;home&apos;, &apos;HomeController@index&apos;);

        也可以使用函数的方式直接返回视图(可加快测试速度)

        Route::get(&apos;/&apos;,    function () {
                return view(&apos;welcome&apos;);
                //视图文件目录位于:my_laravel/resources/views/welcome.blade.php
            }
        );
        //意思是如果访问/域名 显示视图welcome

    //post方式 路由使用函数
        Route::post(&apos;test&apos;,function (){
            return view(&apos;welcome&apos;);
        });

    //any(不管用什么方式get/post等请求都通过),对于不敏感的信息都可以使用这种模式.
        Route::any(&apos;testAny&apos;,function (){
            return &apos;any请求,注册路由响应所有 HTTP 请求&apos;;
        });

    //match 为多种请求注册路由
        Route::match([&apos;get&apos;, &apos;post&apos;], &apos;/&apos;, function()
        {
            return &apos;Hello World&apos;;
        });

    //resource 请求控制器中的所有方法
        //http://localhost/user
        //http://localhost/user/create
        //http://localhost/user/destroy
        //http://localhost/user/update
        //http://localhost/user/show
        //资源 不用像WelcomeController@index指定方法,直接可以调用. 但在项目中不够灵活.
        Route::resource(&apos;user&apos;,&apos;UserController&apos;);

3.2 CSRF保护
    跨站攻击保护机制(跨网站请求伪造))
    例如:原本一个post请求的链接,用户使用第三方工具(如chrome浏览器的Postman插件)伪造post请求
    有CSRF则会对这种请求进行拦截.

3.3 路由传参
    基础路由参数
        Route::get(&apos;user/{id}&apos;, function($id){
            return &apos;User &apos;.$id;
        });

    可选择的路由参数
        Route::get(&apos;user/{name?}&apos;, function($name = null){
            return $name;
        });

    带默认值的路由参数    
        Route::get(&apos;user/{name?}&apos;, function($name = &apos;John&apos;){
            return $name;
        });

    使用正则表达式限制参数
        Route::get(&apos;user/{name}&apos;, function($name){
            //
        })
        -&gt;where(&apos;name&apos;, &apos;[A-Za-z]+&apos;);

        Route::get(&apos;user/{id}&apos;, function($id){
            //
        })
        -&gt;where(&apos;id&apos;, &apos;[0-9]+&apos;);

    使用条件限制数组
        Route::get(&apos;user/{id}/{name}&apos;, function($id, $name){
            //
        })
        -&gt;where([&apos;id&apos; =&gt; &apos;[0-9]+&apos;, &apos;name&apos; =&gt; &apos;[a-z]+&apos;]);

    定义全局模式
        如果你想让特定路由参数总是遵询特定的正则表达式，可以使用 pattern 方法。在 RouteServiceProvider 的 boot 方法里定义模式：

        $router-&gt;pattern(&apos;id&apos;, &apos;[0-9]+&apos;);
        定义模式之后，会作用在所有使用这个特定参数的路由上：

        Route::get(&apos;user/{id}&apos;, function($id)
        {
            // 只有 {id} 是数字才被调用。
        });

    取得路由参数

        如果需要在路由外部取得其参数，使用 input 方法：

        if ($route-&gt;input(&apos;id&apos;) == 1){
            //
        }
        你也可以使用 Illuminate\Http\Request 实体取得路由参数。
        当前请求的实例可以通过 Request facade 取得，或透过类型提示 Illuminate\Http\Request 注入依赖：

        use Illuminate\Http\Request;

        Route::get(&apos;user/{id}&apos;, function(Request $request, $id){
            if ($request-&gt;route(&apos;id&apos;)){
            //
            }
        });


还有如:    方法欺骗 , 命名路由 , 路由群组 , 路由模型绑定 , 抛出 404 错误 等内容 ,见官方文档.
</code></pre><h1 id="控制器-Controller"><a href="#控制器-Controller" class="headerlink" title="控制器(Controller)"></a><a id="控制器(Controller)"></a>控制器(Controller)</h1><pre><code>控制器的作用是请求二级分发者

控制器目录
    my_laravel/app/Http/Controllers/目录下

创建控制器
    手动模式创建:
        例如新创建: my_laravel/app/Http/Controllers/MyController1.php 内容如下
            &lt;?php namespace App\Http\Controllers;
            class MyController1 extends Controller {
                public function getAbout(){
                return &apos;MyController1@ABOUT gogogo&apos;;

                //到视图
                //return view(&apos;my_welcome&apos;);//跳转到my_welcome.blade.php视图View中.
                //传参数方式1 //跳转到my_welcome.blade.php视图View中并带一个参数$name = &apos;comtu&apos;.
                //return view(&apos;my_welcome&apos;)-&gt;with(&apos;name&apos;,&apos;comtu&apos;);
                //传参数方式2 //跳转到my_welcome.blade.php视图View中并带一个参数$name = &apos;name&apos;.
                //$name = &apos;lala&apos;;
                //return view(&apos;my_welcome&apos;,compact(&apos;name&apos;/*[&apos;name&apos;-&gt;&apos;lala&apos;]*/);
                //传参数方式3
                //$data=[
                //    &apos;name&apos; =&gt; &apos;comtu&apos;,
                //    &apos;age&apos; =&gt; 128
                //];
                //return view(&apos;my_welcome&apos;,$data);//传多参数.视图View中直接使用$name , $age即可.
                }
            }
        配置路由
            //http://localhost/myController1
            Route::get(&apos;myController1&apos;,&apos;MyController1@getAbout&apos;);

    命令模型创建(推荐,更准确):

        使用Terminal定位(cmd)目录文件到 my_laravel 目录下 使用artisan命令
        使用命令:
            E:\ComTu_Design\PHP\Apache2.2\htdocs\firstPHPStorm\my_laravel&gt;
            php artisan make:controller MyController

        提示:Controller created successfully. 创建成功.
        查看my_laravel/app/Http/Controllers/MyController.php
        发现会生成生成MyController.php文件 文件里会自动生成类,以及一些方法:
        如:index() , create() , store() , show($id) , edit($id) , update($id) , destroy($id)
        但都是空实现.
</code></pre><h1 id="视图-Views"><a href="#视图-Views" class="headerlink" title="视图(Views)"></a><a id="视图(Views)"></a>视图(Views)</h1><pre><code>MVC显示层

my_laravel/resources/views/xxxx.blade.php

创建View视图
    一般流程为: 创建控制器--&gt;配置路由--&gt;创建视图.

    1.在创建的控制器 MyController.php 中增加如下方法:
        &lt;?php namespace App\Http\Controllers;
        class MyController1 extends Controller {
            public function index(){
                //到视图
                return view(&apos;my_welcome&apos;);//跳转到my_welcome.blade.php视图View中.
            }

            //传参数方式1
            public function parameter(){
                $data=[
                    &apos;name&apos; =&gt; &apos;comtu&apos;,
                    &apos;age&apos; =&gt; 128,
                        &apos;people&apos;=&gt;[&apos;张三&apos;,&apos;李四&apos;,&apos;王五&apos;]
                ];
                return view(&apos;my_welcome&apos;,$data);//传多参数.视图View中直接使用$name , $age即可.
            }
            //传参数方式2
            public function parameter1(){
                $name = &apos;lala&apos;;
                //跳转到my_welcome.blade.php视图View中并带一个参数$name = &apos;lala&apos;.
                return view(&apos;my_welcome&apos;,compact(&apos;name&apos;)/*等同于[&apos;name&apos;-&gt;&apos;lala&apos;]*/);
            }
            //传参数方式3
            public function parameter2(){
                //跳转到my_welcome.blade.php视图View中并带一个参数$name = &apos;comtu&apos;.
                return view(&apos;my_welcome&apos;)-&gt;with(&apos;name&apos;,&apos;comtu&apos;);
            }
        }

    2.配置路由:
        //http://localhost/my_home
        Route::get(&apos;my_home&apos;,&apos;MyController@index&apos;);
        Route::get(&apos;my_home1&apos;,&apos;MyController@parameter&apos;);
        Route::get(&apos;my_home2&apos;,&apos;MyController@parameter1&apos;);
        Route::get(&apos;my_home3&apos;,&apos;MyController@parameter2&apos;);

    3.创建视图文件 
        目录结构为my_laravel/resources/views/my_welcome.blade.php
        &lt;html&gt;
            &lt;head&gt;
                &lt;title&gt;my_welcome&lt;/title&gt;
            &lt;/head&gt;
            &lt;body&gt;
                &lt;div class=&quot;title&quot;&gt;my_welcome--&gt;
                    &lt;?php if(!empty($name)):?&gt;
                        &lt;?php echo $name;?&gt;
                    &lt;?php endif;?&gt;
                &lt;/div&gt;
                &lt;?php if(!empty($age)):?&gt;
                    &lt;div class=&quot;title&quot;&gt;age:&lt;?php echo $age;?&gt;&lt;/div&gt;
                &lt;?php endif;?&gt;
            &lt;/body&gt;
        &lt;/html&gt;

Blade模板

    官方文档: http://laravel.com/docs/5.1/blade
    中文文档: http://www.golaravel.com/laravel/docs/5.0/templates/

    模板:

        {{ }} 
        {!! !!}
        {{{ }}}
        @include
        @if()
        @else
        @endif
        @foreach
        @endforeach
        @for
        @endfor
        @while
        @endwhile
        等

    案例:

    新创建 my_laravel/resources/views/compontents/myHead.blade.php 文件.(用于演示 @include(&apos;components.myHead&apos;))
        &lt;html&gt;
            &lt;body&gt;
                &lt;!--头部文件使用 include 在其它地方引用 --&gt;
                &lt;h1&gt;高大上的头Head&lt;/h1&gt;
                &lt;hr&gt;

            &lt;/body&gt;
        &lt;/html&gt;

    演示代码 my_laravel/resources/views/my_view.blade.php
        &lt;html&gt;
            &lt;head&gt;
                &lt;meta charset=&quot;utf-8&quot;&gt;
                &lt;title&gt;MyView&lt;/title&gt;
            &lt;/head&gt;
            &lt;body&gt;
                &lt;!--引用包含其它文件.--&gt;
                @include(&apos;components.myHead&apos;)
                MyView--&gt;

                &lt;!--调用函数 跨站点请求伪造保护码--&gt;
                {{csrf_token()}} 等同于 &lt;?php echo csrf_token();?&gt;

                &lt;h1&gt;{{ $name or 'Default' }}&lt;/h1&gt;

                &lt;h1&gt;{{ $name or '无名英雄1' }}&lt;/h1&gt;

                &lt;h1&gt;{{ $name or '无名英雄2'}} - {{$age or 0}}&lt;/h1&gt;

                以上等同于
                &lt;h1&gt;&lt;?php echo !empty($name)?$name:&apos;无名英雄3&apos;?&gt;&lt;/h1&gt;


                &lt;!--不解析,原样输出--&gt;
                @{{$name}}

                &lt;!--加载代码--&gt;
                {!! &apos;&lt;script&gt;var g = &quot;comtu&quot;;document.write(&quot;&lt;br /&gt;加载代码&quot;+g+&quot;&lt;br /&gt;&quot;);&lt;/script&gt;&apos; !!}
                {!! &apos;&lt;h1&gt;h1&lt;/h1&gt;&apos; !!}

                        &lt;!--代码转义--&gt;
                {{{'<html lang="en">打印HTML comtu</html>'}}}


                &lt;!--Blade的if判断,如果$name未定义会抛错误--&gt;
                &lt;h1&gt;
                @if($name)
                    你好{{$name}}
                @else
                    未登录
                @endif
                &lt;/h1&gt;


                @foreach($people as $person)
                    &lt;li&gt;{{$person}}&lt;/li&gt;
                @endforeach

                @for($i = 0 ; $i&lt;3; $i++)
                xx
                @endfor

                @while(false)
                xxx
                @endwhile

            &lt;/body&gt;
        &lt;/html&gt;

    以上在浏览器中输出
        高大上的头Head

        MyView--&gt; YNJhQ4GgCCuZ5qyPNhTwvFvWfYLduxUOFvEz0vnZ 等同于 YNJhQ4GgCCuZ5qyPNhTwvFvWfYLduxUOFvEz0vnZ
        Default

        无名英雄1

        无名英雄2 - 0

        以上等同于
        无名英雄3

        {{$name}} 
        加载代码comtu
        h1

        &lt;html lang=&quot;en&quot;&gt;打印HTML comtu&lt;/html&gt;

        未登录

        张三
        李四
        王五
        xx xx xx
</code></pre><h1 id="模型-model"><a href="#模型-model" class="headerlink" title="模型(model)"></a><a id="模型(model)"></a>模型(model)</h1><pre><code>模型层
    一般model在 my_laravel/app/目录下
    直接或间接继承Model;
    原代码目录:
    //my_laravel/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php
    Laravel的Model比CI的Model内容可多很多.里面包含了查询数据库等等的函数实现.
    8.Eloguent里面有Demo


创建模型
    手动模式创建:
        例如新创建: my_laravel/app/Demo.php内容如下:        

        修改Model的文件目录,新创建 my_laravel/app/Model 在Model里面创建Model文件.
        并在 文件头&lt;?php namespace App\Model;//指定目录即可            

        &lt;?php namespace App;
            use Illuminate\Database\Eloquent\Model;
            class Demo extends Model {
                use Authenticatable, CanResetPassword;
                /**使用的数据库表模式。*/
                protected $table = &apos;demo&apos;;

                /**属性可分配。*/
                //表示那些字段是可以被laravel填写的.
                protected $fillable = [&apos;name&apos;, &apos;email&apos;, &apos;password&apos;];

                //表示这些字段是被保护的,存储数据库时不填写此数据
                protected $guarded = [&apos;demo_id&apos;];

                /** 排除在模型的JSON形式的属性。*/
                protected $hidden = [&apos;password&apos;, &apos;remember_token&apos;];

                 //修改默认的 id 主键
                protected $primaryKey = &apos;demo_id&apos;;

                //不使用时间戳_见下面创建模型
                public $timestamps = false;
            }

    命令模型创建:
        使用Terminal定位(cmd)目录文件到 my_laravel 目录下 使用artisan命令
            php artisan make:model Demo
            创建在 my_laravel/app/Demo.php 文件如下:

            &lt;?php namespace App;
            use Illuminate\Database\Eloquent\Model;
            class Demo extends Model {
                //....
            }
</code></pre><h1 id="环境与部署"><a href="#环境与部署" class="headerlink" title="环境与部署"></a><a id="环境与部署"></a>环境与部署</h1><pre><code>.env 环境配置文件.

    文件目录 my_laravel/.env

    作用到全局的一些参数
    例如:
    APP_ENV=local   全称APP_Envirment 程序环境=local表示环境在本地.server表示运行在服务器.debug需要改成0或false
    APP_DEBUG=true  是否在开发模式下.如果true,则是开发模式,出错时会报错,并会尽量多打印信息.0或false表示正式模式.
    APP_KEY=asdf    应用的加密key,标记唯一性,例如框架需要加密时,有可能会使用到,当做参数使用.

    DB_HOST=localhost 数据库地址 这些参数会被 database.php 等配置文件调用.
    DB_DATABASE=my_laravel 数据库名
    DB_USERNAME=root  数据库用户名
    DB_PASSWORD=root  数据库密码

    CACHE_DRIVER=file   缓存使用文件形式
    SESSION_DRIVER=file Session使用文件形式
    QUEUE_DRIVER=sync   队列使用同步

    MAIL_DRIVER=smtp      邮件配置
    MAIL_HOST=mailtrap.io
    MAIL_PORT=2525
    MAIL_USERNAME=null
    MAIL_PASSWORD=null


    先创建数据库 见下面的&quot;数据库CMD&quot;
    //路由中,尝试连接数据库
    Route::get(&apos;myDatabase&apos;,function(){
        $name = DB::connection()-&gt;getDatabaseName();
        echo $name; //打印出 数据库名 my_laravel 表示成功 如果遇见PDOException错误见&quot;我遇到的错误&quot;中的解决方法
    });

数据库
    my_laravel/config/database.php

    一般不用配置当前文件,配置 my_laravel/.env 文件即可.

    &apos;default&apos; =&gt; &apos;mysql&apos; 默认使用的数据库
    &apos;connections&apos; =&gt; [
        &apos;mysql&apos; =&gt; [
            &apos;driver&apos;    =&gt; &apos;mysql&apos;,
            //引用my_laravel/.env 环境配置文件的配置,如果没有找到则使用默认的&apos;localhost&apos;.
            &apos;host&apos;      =&gt; env(&apos;DB_HOST&apos;, &apos;localhost&apos;), 
            &apos;database&apos;  =&gt; env(&apos;DB_DATABASE&apos;, &apos;forge&apos;),
            &apos;username&apos;  =&gt; env(&apos;DB_USERNAME&apos;, &apos;forge&apos;),
            &apos;password&apos;  =&gt; env(&apos;DB_PASSWORD&apos;, &apos;&apos;),
            &apos;charset&apos;   =&gt; &apos;utf8&apos;,
            &apos;collation&apos; =&gt; &apos;utf8_unicode_ci&apos;,
            &apos;prefix&apos;    =&gt; &apos;&apos;, //前缀
            &apos;strict&apos;    =&gt; false,
        ],
    ]

Session

    配置文件 my_laravel/config/session.php 一般此文件不需要配置

        //可支持配置 &quot;file&quot;, &quot;cookie&quot;, &quot;database&quot;, &quot;apc&quot;,&quot;memcached&quot;, &quot;redis&quot;, &quot;array&quot;
        &apos;driver&apos; =&gt; env(&apos;SESSION_DRIVER&apos;, &apos;file&apos;),

down/up
    一整个程序停止解析(使用场景如,网站遇到攻击,网站需要维护等)
    配置后访问网站的所有地址都会被跳转到 my_laravel/resources/views/errors/503.blade.php 网站全部连接转向此文件.

        //停止服务,
        php artisan down 

        //恢复服务
        pup artisan up 

自定义配置属性
    1.在.env中增加属性
        MY_DIY_CONFIG=&apos;test_env&apos;
    2.在config/app.php内容里增加属性(参数1为.env文件下的配置名,如果未配置.则使用参数2默认值)
        &apos;my_diy_config&apos; =&gt;env(&apos;MY_DIY_CONFIG&apos;,&apos;test_app&apos;),
    3.使用 例如在Controllers中使用:
        use Illuminate\Support\Facades\Config;//引入包
        //code...
        $diyConfig = Config::get(&apos;app.my_diy_config&apos;);//使用
        //code...

自动加载类
    使用场景:当某一个方法函数经常会被多个不同的类调用时.可做成自动加载的类,减少代码编写量
    1.创建文件 例如:在app/Libraries/function/functions.php (自定义)里面有如下代码:
        &lt;?php 
        funcion abc(){
            return &apos;abc&apos;;
        }
    2.在工程 /bootstrap/autoload.php 中增加如下代码(对应自定义的文件目录):
        require __DIR__.&apos;/../app/Libraries/function/functions.php&apos;;
    3.使用 例如在Controllers中使用
        直接使用方法名调用: $data = abc();
</code></pre><h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a><a id="数据库"></a>数据库</h1><pre><code>与数据库交互的机制.
    http://www.golaravel.com/laravel/docs/5.0/eloquent/

目录my_laravel/vendor/laravel/framework/src/Illuminate/Database/Eloquent/包含多文件,Model属于此包


Eloguent 使用(增删改查):
    配置数据库信息
        my_laravel/.env
            DB_HOST=localhost
            DB_DATABASE=my_laravel
            DB_USERNAME=root
            DB_PASSWORD=root

    配置路由: 
        //http://localhost:8888/myDatabase 查看连接数据库是否成功
        Route::get(&apos;myDatabase&apos;,function(){
            $name = DB::connection()-&gt;getDatabaseName();
            echo $name;
        });

        //http://localhost:8888/myDatabase/add 增
        Route::get(&apos;myDatabase/add&apos;,function(){
            $user = new App\User();
            $user-&gt;userAdd();
            return $user-&gt;userRead();
        });

        //http://localhost:8888/myDatabase/delete 删
        Route::get(&apos;myDatabase/delete&apos;,function(){
            $user = new App\User();
            $user-&gt;userDelete();
            return $user-&gt;userRead();
        });

        //http://localhost:8888/myDatabase/update 改
        Route::get(&apos;myDatabase/update&apos;,function(){
            $user = new App\User();
            $user-&gt;userDelete();
            return $user-&gt;userRead();
        });

        //http://localhost:8888/myDatabase/read 查
        Route::get(&apos;myDatabase/read&apos;,function(){
            $user = new App\User();
            return $user-&gt;userRead();
        });

        //http://localhost:8888/myDatabase/read_dd 查
        Route::get(&apos;myDatabase/read_dd&apos;,function(){
            $user = new App\User();
            $users = $user-&gt;all();
            dd($users); // dd=&gt; var_dump() ; and die(); 打印出数据类型与信息.
            // $users-&gt;toArray();//转成数组
            // $users-&gt;all();//返回数据库原型 , 默认调用了tojson();
            // return $user-&gt;userRead();

            //数组
            $arr = [&apos;one&apos;,&apos;two&apos;,&apos;three&apos;];
            $collection = collect($arr);
            //查找数组是否包含对应的值
            $bool = $collection-&gt;contains(&apos;one&apos;);
            //取数组的前2个数据
            $res = $collection-&gt;take(2);
            //取后面两个数据
            $res = $collection-&gt;take(-2);

            //键值对
            $arr = [&apos;one&apos;=&gt;1,&apos;two&apos;=&gt;2,&apos;three&apos;=&gt;3];
            $collection = collect($arr);
            //查找是否有对应的键key
            $bool = $collection-&gt;has(&apos;one&apos;);

            return $collection-&gt;all();
        });

    创建模型:

        &lt;?php namespace App;

        use Illuminate\Auth\Authenticatable;
        use Illuminate\Database\Eloquent\Model;
        use Illuminate\Auth\Passwords\CanResetPassword;
        use Illuminate\Contracts\Auth\Authenticatable as AuthenticatableContract;
        use Illuminate\Contracts\Auth\CanResetPassword as CanResetPasswordContract;

        //Laravel的Model已经实现了一些对数据库的操作,如增删改查.
        class User extends Model implements AuthenticatableContract, CanResetPasswordContract {
            use Authenticatable, CanResetPassword;

            //数据库名 重写Model的数据库名
            protected $table = &apos;users&apos;;

            //表示那些数据库字段是可以被laravel填写.
            protected $fillable = [&apos;username&apos;, &apos;age&apos;];

            //表示这些字段是被保护的,存储数据库时不填写此数据(主键自动增长)
            protected $guarded = [&apos;demo_id&apos;];

            // 排除在模型的JSON形式的属性。如调用$this-&gt;all()生成的Json不生成在Json中的字段名
            protected $hidden = [];

            //修改默认的 id 主键名称
            protected $primaryKey = &apos;user_id&apos;;

            ////model自带的方法 public static function all($columns = array(&apos;*&apos;)) 函数
            //详情见 my_laravel/vendor/laravel/framework/src/Illuminate/Database/Eloquent/Model.php
            //查询数据《-----------------------
            public function userRead(){
                //查询出所有数据
                //return $this-&gt;all();

                //查找user_id为1的数据 如果没有打到数据,返回的空数据
                //return $this-&gt;find(1);
                //如没有找到数据直接抛异常.查id为4的数据
                //return $this-&gt;findOrFail(4);

                //返回对应条件的数据 select * from users where username=&apos;comtu&apos;;
                //return $this-&gt;where(&apos;username&apos;,&apos;comtu&apos;)-&gt;get();

                //返回对应条件的数据 select * from users where user_id&gt;1; 
                // return $this-&gt;where(&apos;user_id&apos;,&apos;&gt;&apos;,1)-&gt;get();

                //查询出所有数据 等同于 $this-&gt;all();
                return $this-&gt;get();
            }

            //insert数据时model基类默认数据库中有时间戳字段,更新时间,创建时间
            //处理方式有两种,一种是为数据库中增加这两个字段`updated_at`, `created_at`
            //另一种是取消Model中的数据库时间戳字段如下:
            public $timestamps = false;

            //增加数据《-----------------------
            public function userAdd(){

                //增加数据方式1 
                //$this-&gt;username = &apos;user00000&apos;;
                //$this-&gt;age = 1;
                //$this-&gt;save();
                //增加数据后如果表是自动增长的可获取到增加后的id
                $id = $this-&gt;user_id;//新增加后的id值

                //增加数据方式2  批量赋值 
                //protected $fillable = [&apos;username&apos;, &apos;age&apos;]; //需要有配置自动填充的字段
                $user_data = [&apos;username&apos;=&gt;&apos;user111&apos;,&apos;age&apos;=&gt;256];
                $this-&gt;fill($user_data);
                $this-&gt;save();
            }

            //更新数据《-----------------------
            public function userUpdate(){
                //修改对应的数据 方式一
                //$user = $this-&gt;find(1);//查询-》保存
                //$user-&gt;username = &apos;comtu0000&apos;;
                //$user-&gt;age = &apos;512&apos;;
                //$user-&gt;save();

                //修改对应的数据 方式二
                $users = $this-&gt;where(&apos;user_id&apos;,&apos;&lt;&apos;,&apos;3&apos;); //查询-》更新
                //更新不需要调用save()
                $users-&gt;update([&apos;username&apos;=&gt;&apos;comtu1111&apos;,&apos;age&apos;=&gt;1024]);
            }

            //删除数据《-----------------------
            public function userDelete(){
                $user = $this-&gt;find(3);//查询-》删除
                $user-&gt;dalete();
            }
        }

    Demo:
        模型:
            &lt;?php namespace App\Model;
            use Illuminate\Database\Eloquent\Model;

            class Person extends Model  {

                 //数据库表
                protected $table = &apos;person&apos;;
                //修改默认的 id 主键
                protected $primaryKey = &apos;pid&apos;;

                //表示那些字段是可以被laravel填写的.fill()
                protected $fillable = [&apos;name&apos;, &apos;sex&apos;,&apos;age&apos;,&apos;salary&apos;,&apos;occ_id&apos;,&apos;dep_id&apos;];

                //表示这些字段是被保护的,存储数据库时不填写此数据
                protected $guarded = [&apos;pid&apos;];

                //生成JSON时隐藏的字段
                protected $hidden = [];

                //insert数据时model基类默认数据库中有时间戳字段,更新时间,创建时间
                //处理方式有两种,一种是为数据库中增加这两个字段`updated_at`, `created_at`
                //另一种是取消Model中的数据库时间戳字段如下:
                public $timestamps = false;

                //表结构对应关系 occupation另外一张表app/model/occupation.php
                public function occupation(){
                return $this-&gt;hasOne(&apos;App\Model\occupation&apos;, &apos;occ_id&apos;, &apos;occ_id&apos;);
                }

                //表结构对应关系
                public function department(){
                return $this-&gt;hasOne(&apos;App\Model\department&apos;, &apos;dep_id&apos;, &apos;dep_id&apos;);
                }
            }

        控制器:
            app/Http/Controllers/DemoDataBaseController.php
                &lt;?php namespace App\Http\Controllers;
                use App\Http\Requests;
                use App\Http\Controllers\Controller;

                use App\Model\Occupation;
                use App\Model\Department;
                use App\Model\Person;
                use Illuminate\Support\Facades\Input;
                use Illuminate\Support\Facades\Request;
                use Illuminate\Support\Facades\Session;


                class DemoDataBaseController extends Controller{

                    public function index() {
                    //$data[&apos;person&apos;] = Person::find(array(&apos;1&apos;));//简单条件查询 select * from person where id = 1;
                    //$data[&apos;person&apos;] = Person::whereRaw(&apos;pid &gt; 1 and salary &gt; 1700&apos;)-&gt;get();//条件查询全部

                    //连表查询~~需要在Person里面配置表的关系
                    $data[&apos;person&apos;] = Person::with(&apos;occupation&apos;, &apos;department&apos;)-&gt;paginate(10);//连表查询并 paginate分页功能,每页10条.
                    //$data[&apos;person&apos;] = Person::with(&apos;occupation&apos;,&apos;department&apos;)-&gt;get();//连表查询 //只能使用get,all获取不到数据
                    //&lt;?php foreach ($person as $v):?&gt;//视图中获取连表的数据
                    //&lt;?php echo $v[&apos;occupation&apos;]-&gt;name;?&gt; 
                    //&lt;?php endforeach;?&gt;
                    $data[&apos;count&apos;]  =  Person::all()-&gt;count();
                    $data[&apos;occupation&apos;] = Occupation::get();//查询全部
                    $data[&apos;department&apos;] = Department::all();//查询全部

                    return view(&apos;demo.demo_index_database&apos;,$data);
                    }

                    public function addPerson(){
                    $data[&apos;occupation&apos;] = Occupation::get();//查询全部
                    $data[&apos;department&apos;] = Department::all();//查询全部
                    return view(&apos;demo.demo_add_update_database&apos;,$data);
                    }

                    public function postAddPerson(){
                    $person = new Person();
                    //增加数据方式2
                    $person-&gt;name = Request::input(&apos;name&apos;, &apos;default&apos;);//获取Post请求的数据
                    $person-&gt;age = Request::input(&apos;age&apos;, 20);
                    $person-&gt;sex = Request::input(&apos;sex&apos;, 0);
                    $person-&gt;salary = Request::input(&apos;salary&apos;, 1800);
                    $person-&gt;occ_id = Request::input(&apos;occ_id&apos;);
                    $person-&gt;dep_id = Request::input(&apos;dep_id&apos;);
                    $person-&gt;save();
                    //$person-&gt;pid; 可获取到增加后的自动增长id.
                    return redirect(&apos;myDatabase/Demo&apos;);
                    }

                    public function deletePerson($rid,$_token = &apos;&apos;){
                    if(Session::token() !== $_token) {
                        echo &apos;非法请求&apos;;
                        return;
                    }

                    $person = Person::find($rid);
                    $person-&gt;delete();
                    return redirect(&apos;myDatabase/Demo&apos;);
                    }

                    //http://localhost/myDatabase/DemoUpdatePerson?pid=6&amp;_token=7jcZiP2wv0nIpxrA4KUqn9sBRaU7YXpcc8M0zrue
                    public function updatePerson(){
                    $_token = Input::get(&apos;_token&apos;);//获取get请求的数据
                    if(Session::token()!=$_token){
                        echo &apos;非法请求&apos;;
                        return ;
                    }
                    $pid = Input::get(&apos;pid&apos;);

                    $data[&apos;person&apos;] = Person::find($pid);
                    $data[&apos;occupation&apos;] = Occupation::all();//查询全部
                    $data[&apos;department&apos;] = Department::get();//查询全部
                    return view(&apos;demo.demo_add_update_database&apos;,$data);
                    }

                    public function postUpdatePerson(){
                    $person = Person::find(Request::input(&apos;pid&apos;));
                    if(!$person){
                        echo &apos;修改错误&apos;;
                        return;
                    }

                    //修改数据方式
                    $person-&gt;name = Request::input(&apos;name&apos;);
                    $person-&gt;age = Request::input(&apos;age&apos;);
                    $person-&gt;sex = Request::input(&apos;sex&apos;);
                    $person-&gt;salary = Request::input(&apos;salary&apos;);
                    $person-&gt;occ_id = Request::input(&apos;occ_id&apos;);
                    $person-&gt;dep_id = Request::input(&apos;dep_id&apos;);
                    $person-&gt;save();
                    return redirect(&apos;myDatabase/Demo&apos;);
                    }
                }

        路由:
            app/Http/routes.php

                //显示列表 http://localhost/myDatabase/Demo
                Route::get(&apos;myDatabase/Demo&apos;,&apos;DemoDataBaseController@index&apos;);
                //增加数据
                Route::get(&apos;myDatabase/DemoAddPerson&apos;,&apos;DemoDataBaseController@addPerson&apos;);
                Route::post(&apos;myDatabase/DemoAddPerson&apos;,&apos;DemoDataBaseController@postAddPerson&apos;);
                //删除数据 使用函数参数方式并参数使用正则匹配.
                Route::get(&apos;myDatabase/DemoDeletePerson/{pid}/{_token}&apos;,&apos;DemoDataBaseController@deletePerson&apos;)-&gt;where([&apos;pid&apos; =&gt; &apos;[0-9]+&apos;]);
                //更新数据 此处使用获取get请求的方式获取数据
                Route::get(&apos;myDatabase/DemoUpdatePerson&apos;,&apos;DemoDataBaseController@updatePerson&apos;);
                Route::post(&apos;myDatabase/DemoUpdatePerson&apos;,&apos;DemoDataBaseController@postUpdatePerson&apos;);

                //scrf验证
                Route::filter(&apos;csrf&apos;,function(){
                    if (Session::token() !== Input::get(&apos;_token&apos;)) {
                    throw new Illuminate\Session\TokenMismatchException;
                    }
                });

        视图:
            resources/views/demo/demo_index_database.blade.php 显示列表
                &lt;html&gt;
                &lt;head&gt;
                    &lt;meta charset=&quot;utf-8&quot;&gt;
                    &lt;title&gt;MyView&lt;/title&gt;
                    &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/style.css&quot;&gt;
                &lt;/head&gt;
                &lt;body&gt;
                @include(&apos;components.myHead&apos;)

                &lt;h1&gt;resources/views/demo_database.blade.php&lt;/h1&gt;

                调用函数@{{csrf_token}} 跨站点请求伪造保护码
                {{csrf_token()}} 等同于 &lt;?php echo csrf_token();?&gt;

                &lt;table   border=&quot;1px&quot; cellpadding=&quot;2px&quot;  cellspacing=&quot;1px&quot; bgcolor=&quot;#FFFFF0&quot;&gt;
                    &lt;tr align=&quot;center&quot;&gt;
                    &lt;td&gt;pid(count:{{$count}})&lt;/td&gt;
                    &lt;td&gt;name&lt;/td&gt;
                    &lt;td&gt;age&lt;/td&gt;
                    &lt;td&gt;sex&lt;/td&gt;
                    &lt;td&gt;salary&lt;/td&gt;
                    &lt;td&gt;occ_id&lt;/td&gt;
                    &lt;td&gt;dep_id&lt;/td&gt;
                    &lt;td&gt;操作&lt;/td&gt;
                    &lt;/tr&gt;
                    @foreach($person as $p)
                    &lt;tr align=&quot;center&quot;&gt;
                    &lt;td&gt;{{$p->pid}}&lt;/td&gt;
                    &lt;td&gt;{{$p->name}}&lt;/td&gt;
                    &lt;td&gt;&lt;?php echo $p-&gt;age?&gt;&lt;/td&gt;
                    &lt;td&gt;{{$p->sex==0?'男':'女'}}&lt;/td&gt;
                    &lt;td&gt;{{$p->salary}}&lt;/td&gt;
                    &lt;td&gt;{{$p->occupation->name}}&lt;/td&gt;&lt;!--连表查询,预载入的关联对象--&gt;
                    &lt;td&gt;{{$p->department->name}}&lt;/td&gt;
                    &lt;td&gt;&lt;a href=&quot;{{url('myDatabase/DemoUpdatePerson?pid='.$p->pid.'&_token='.csrf_token())}}&quot;&gt;修改&lt;/a&gt; &amp;nbsp &lt;a href=&quot;{{url('myDatabase/DemoDeletePerson').'/'.$p->pid .'/'.csrf_token()}}&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    @endforeach

                    @if($person-&gt;render())
                    &lt;tr &gt;&lt;td colspan=&quot;9&quot; align=&quot;center&quot; width=&quot;100%&quot;&gt;&lt;?php echo $person-&gt;render(); ?&gt;&lt;!--分页--&gt;&lt;/td&gt;&lt;/tr&gt;
                    @endif
                &lt;/table&gt;

                &lt;div style=&quot;clear: both&quot;&gt;&lt;/div&gt;

                &lt;a href=&quot;{{url('myDatabase/DemoAddPerson')}}&quot;&gt;增加&lt;/a&gt;

                &lt;hr&gt;

                &lt;/body&gt;
                &lt;/html&gt;

            resources/views/demo/demo_add_update_database.blade.php 增加/修改页
                &lt;html&gt;
                &lt;head&gt;
                    &lt;meta charset=&quot;utf-8&quot;&gt;
                    &lt;title&gt;{{empty($person)?'增加':'更新'}}数据&lt;/title&gt;
                    &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/style.css&quot;&gt;
                &lt;/head&gt;
                &lt;body&gt;

                &lt;form action=&quot;{{empty($person)?url('myDatabase/DemoAddPerson'):url('myDatabase/DemoUpdatePerson')}}&quot; method=&quot;post&quot; &gt;
                    &lt;input type=&quot;hidden&quot; name=&quot;_token&quot; value=&quot;{{csrf_token()}}&quot;&gt;
                    &lt;?php echo empty($person)?&apos;&apos;:&apos;&lt;input type=&quot;hidden&quot; name=&quot;pid&quot; value=&quot;&apos;.$person-&gt;pid.&apos;&quot;&gt;&apos; ;?&gt;
                    &lt;table border=&quot;1px&quot; cellpadding=&quot;2px&quot;  cellspacing=&quot;1px&quot; bgcolor=&quot;#FFFFF0&quot;&gt;
                    &lt;tr&gt;&lt;td&gt;名称&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;{{empty($person)?'':$person->name}}&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;&lt;td&gt;年龄&lt;/td&gt;&lt;td&gt;
                        &lt;select name=&quot;age&quot; &gt;
                            @for ($i = 1; $i &lt;= 110; $i++)
                            &lt;option value=&quot;{{ $i }}&quot; &lt;?php echo $i==(empty($person)?24:$person-&gt;age) ?&apos;selected=&quot;selected&quot;&apos;:&apos;&apos;?&gt;&gt;{{ $i }}&lt;/option&gt;
                            @endfor
                        &lt;/select&gt;
                        &lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;&lt;td&gt;性别&lt;/td&gt;&lt;td&gt;
                        &lt;select name=&quot;sex&quot;&gt;
                            &lt;option value=&quot;0&quot; &lt;?php echo empty($person)?&apos;selected=&quot;selected&quot;&apos;:$person-&gt;sex==0?&apos;selected=&quot;selected&quot;&apos;:&apos;&apos;?&gt;&gt;男&lt;/option&gt;
                            &lt;option value=&quot;1&quot; &lt;?php echo empty($person)?&apos;&apos;:$person-&gt;sex==1?&apos;selected=&quot;selected&quot;&apos;:&apos;&apos;?&gt;&gt;女&lt;/option&gt;
                        &lt;/select&gt;
                        &lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;&lt;td&gt;薪资&lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;salary&quot; value=&quot;{{empty($person)?'':$person->salary}}&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;&lt;td&gt;职业&lt;/td&gt;&lt;td&gt;
                        &lt;select name=&quot;occ_id&quot;&gt;
                            @for($i = 0 ; $i&lt; count($occupation);$i++)
                            &lt;option value=&quot;{{$occupation[$i]->occ_id}}&quot; &lt;?php echo empty($person)?&apos;&apos;:$occupation[$i]-&gt;occ_id==($person-&gt;occ_id)?&apos;selected=&quot;selected&quot;&apos;:&apos;&apos;?&gt;&gt;{{$occupation[$i]->name}}&lt;/option&gt;
                            @endfor
                            {{--@foreach($occupation as $occ)--}}
                            {{--<option value="{{$occ->occ_id}}&quot; &gt;{{$occ->name}}&lt;/option&gt;--}}
                            {{--@endforeach--}}
                        &lt;/select&gt;
                        &lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;&lt;td&gt;部门&lt;/td&gt;&lt;td&gt;
                        &lt;select name=&quot;dep_id&quot; &gt;
                            @for($i = 0 ; $i&lt; count($department);$i++)
                            &lt;option value=&quot;{{$department[$i]->dep_id}}&quot; &lt;?php echo empty($person)?&apos;&apos;:$department[$i]-&gt;dep_id==($person-&gt;dep_id)?&apos;selected=&quot;selected&quot;&apos;:&apos;&apos;?&gt;&gt;{{$department[$i]->name}}&lt;/option&gt;
                            @endfor
                            {{--@foreach($department as $dep)--}}
                            {{--<option value=" {{$dep-="">dep_id}}&quot; &gt;{{$dep->name}}&lt;/option&gt;--}}
                            {{--@endforeach--}}
                        &lt;/select&gt;
                        &lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;&lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;{{empty($person)?'增加':'更新'}}&quot;&gt;&amp;nbsp&lt;input type=&quot;reset&quot; value=&quot;重置&quot;&gt;&lt;/td&gt;&lt;/tr&gt;
                    &lt;/table&gt;
                &lt;/form&gt;

                &lt;/body&gt;
                &lt;/html&gt;
</option></code></pre><h1 id="请求"><a href="#请求" class="headerlink" title="请求"></a><a id="请求"></a>请求</h1><pre><code>Demo:
    控制器:
        app/Http/Controlers/DemoMyRequestController.php 
            &lt;?php namespace App\Http\Controllers;

            use App\Http\Requests;
            use App\Http\Controllers\Controller;

            use Illuminate\Support\Facades\Input;
            use Illuminate\Support\Facades\Request;
            use Illuminate\Support\Facades\Session;

            class DemoMyRequestController extends Controller{

                //请求
                public function myrequest(){
                //获取表单发送过来的所有数据,不管是get,post还是其它请求的数据.
                $input = Request::all();//返回json数据
                var_dump($input);
                echo &apos;&lt;br&gt;&apos;;

                $value = Request::query();//获取get请求?后面的所有参数
                var_dump($value);
                echo &apos;&lt;br&gt;&apos;;
                $value = Request::query(&apos;name&apos;);//获取get请求后面的指定参数
                var_dump($value);
                echo &apos;&lt;br&gt;&apos;;

                //get请求方式,如果没有name键则取默认值comtu
                $value = Request::get(&apos;name&apos;,&apos;comtu&apos;);
                var_dump($value);
                echo &apos;&lt;br&gt;&apos;;

                //-----判断-------
                //判断参数是否存在返回布尔值
                $bool = Request::has(&apos;name&apos;);
                var_dump($bool);
                echo &apos;&lt;br&gt;&apos;;

                //http://localhost/myrequest?name=&amp;age=11
                //检查是否存在键,有则返回true,不检查键对应的值是否存在.
                $bool = Request::exists(&apos;name&apos;);
                var_dump($bool);
                echo &apos;&lt;br&gt;&apos;;

                //-------请求检索-------
                //过滤值,只取对应的键值
                $value = Request::only(&apos;name&apos;);
                var_dump($value);
                echo &apos;&lt;br&gt;&apos;;
                $value = Request::only(&apos;name&apos;,&apos;age&apos;);//如果有多个参数,则只取这两个值
                var_dump($value);
                echo &apos;&lt;br&gt;&apos;;

                //过滤值,除了对应的键不取,其它数据获取,用法与only类似
                $value = Request::except(&apos;name&apos;);
                var_dump($value);
                echo &apos;&lt;br&gt;&apos;;

                //-----------url---------
                //返回请求的url前缀_不包括参数
                $url = Request::url();
                var_dump($url);
                echo &apos;&lt;br&gt;&apos;;

                //返回请求的全部url_包含参数
                $url = Request::fullUrl();
                var_dump($url);
                echo &apos;&lt;br&gt;&apos;;

                //----------请求历史----------
                //将请求的所有数据存储到session数据中.
                Request::flash();
                //Request::flashOnly(&apos;name&apos;);//只存储指定的键值
                //Request::flashExcept(&apos;name&apos;);//除了指定的键值,其它都存储

                //返回上一次请求的数据,可在不同页面中获取,前提是需要调用了Request::flash()
                $value = Request::old();//可用于保存用户提交失败时恢复历史数据的功能
                var_dump($value);

                /*
                请求: http://localhost/myrequest?name=comtu&amp;age=11

                array(2) { [&quot;name&quot;]=&gt; string(5) &quot;comtu&quot; [&quot;age&quot;]=&gt; string(2) &quot;11&quot; }
                array(2) { [&quot;name&quot;]=&gt; string(5) &quot;comtu&quot; [&quot;age&quot;]=&gt; string(2) &quot;11&quot; }
                string(5) &quot;comtu&quot;
                string(5) &quot;comtu&quot;
                bool(true)
                bool(true)
                array(1) { [&quot;name&quot;]=&gt; string(5) &quot;comtu&quot; }
                array(2) { [&quot;name&quot;]=&gt; string(5) &quot;comtu&quot; [&quot;age&quot;]=&gt; string(2) &quot;11&quot; }
                array(1) { [&quot;age&quot;]=&gt; string(2) &quot;11&quot; }
                string(26) &quot;http://localhost/myrequest&quot;
                string(44) &quot;http://localhost/myrequest?age=11&amp;name=comtu&quot;
                array(2) { [&quot;name&quot;]=&gt; string(5) &quot;comtu&quot; [&quot;age&quot;]=&gt; string(2) &quot;11&quot; }
                */

                /*
                  请求http://localhost/myrequest?nae=comtu&amp;age=11
                array(2) { [&quot;nae&quot;]=&gt; string(5) &quot;comtu&quot; [&quot;age&quot;]=&gt; string(2) &quot;11&quot; }
                array(2) { [&quot;nae&quot;]=&gt; string(5) &quot;comtu&quot; [&quot;age&quot;]=&gt; string(2) &quot;11&quot; }
                NULL
                string(5) &quot;comtu&quot;
                bool(false)
                bool(false)
                array(1) { [&quot;name&quot;]=&gt; NULL }
                array(2) { [&quot;name&quot;]=&gt; NULL [&quot;age&quot;]=&gt; string(2) &quot;11&quot; }
                array(2) { [&quot;nae&quot;]=&gt; string(5) &quot;comtu&quot; [&quot;age&quot;]=&gt; string(2) &quot;11&quot; }
                string(26) &quot;http://localhost/myrequest&quot;
                string(43) &quot;http://localhost/myrequest?age=11&amp;nae=comtu&quot;
                array(2) { [&quot;name&quot;]=&gt; string(5) &quot;comtu&quot; [&quot;age&quot;]=&gt; string(2) &quot;11&quot; }
                */
                }

                //显示上传页面
                public function uploadFile(){
                return view(&apos;demo.demo_index_MyRequest&apos;);
                }

                //提交上传数据
                public function postUploadFile(){
                //返回post上来的数据 返回数组
                var_dump(Request::file());
                echo &apos;&lt;br&gt;&apos;; echo &apos;&lt;br&gt;&apos;;

                //返回对象
                var_dump(Request::file(&apos;my_file&apos;));
                echo &apos;&lt;br&gt;&apos;; echo &apos;&lt;br&gt;&apos;;

                //返回布尔值,是否包含文件
                $bool = Request::hasFile(&apos;my_file&apos;);
                var_dump($bool);
                echo &apos;&lt;br&gt;&apos;; echo &apos;&lt;br&gt;&apos;;

                //返回文件大小
                $size = Request::file(&apos;my_file&apos;)-&gt;getClientSize();
                var_dump($size);
                echo &apos;&lt;br&gt;&apos;; echo &apos;&lt;br&gt;&apos;;

                //返回上传时的文件名
                $name = Request::file(&apos;my_file&apos;)-&gt;getClientOriginalName();
                var_dump($name);
                echo &apos;&lt;br&gt;&apos;; echo &apos;&lt;br&gt;&apos;;

                //返回文件格式
                $extension = Request::file(&apos;my_file&apos;)-&gt;getClientOriginalExtension();
                var_dump($extension);
                echo &apos;&lt;br&gt;&apos;; echo &apos;&lt;br&gt;&apos;;

                //判断上传的文件是否有效
                if (Request::file(&apos;my_file&apos;)-&gt;isValid()){
                    //移动上传的文件到指定目录 人在public目录下自动创建uploads目录并把文件存储到当前目录中.
                    $destinationPath = &apos;uploads/&apos;;
                    Request::file(&apos;my_file&apos;)-&gt;move($destinationPath, uniqid().&apos;.&apos;.$extension); //md5 uniqid 唯一标识
                }
                }


            }

    路由:
        app/Http/routes.php    

            //http://localhost/myrequest
            //http://localhost/myrequest?name=&amp;age=11
            //http://localhost/myrequest?name=comtu&amp;age=11
            //http://localhost/myrequest?na2me=comtu&amp;age=11
            Route::any(&apos;myrequest&apos;,&apos;DemoMyRequestController@myrequest&apos;);

            //文件上传
            Route::any(&apos;uploadFile&apos;,&apos;DemoMyRequestController@uploadFile&apos;);
            Route::post(&apos;uploadFile&apos;,&apos;DemoMyRequestController@postUploadFile&apos;);

    视图:
        resources/views/demo/demo_index_MyRequest.blade.php
            &lt;html&gt;
            &lt;head&gt;
                &lt;meta charset=&quot;utf-8&quot;&gt;
                &lt;title&gt;MyView&lt;/title&gt;
                &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/style.css&quot;&gt;
            &lt;/head&gt;
            &lt;body&gt;
            {{--<form action="uploadFile" method="post" enctype="application/x-www-form-urlencoded">--}}
                &lt;form action=&quot;uploadFile&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
                &lt;input type=&quot;hidden&quot; name=&quot;_token&quot; value=&quot;{{csrf_token()}}&quot;&gt;
                &lt;fieldset style=&quot;width:230px&quot; &gt;
                &lt;legend&gt;上传文件&lt;/legend&gt;
                选择文件:&lt;input type=&quot;file&quot; name=&quot;my_file&quot; multiple /&gt;  &lt;br /&gt;
                {{--选择文件:<input type="file" name="my_file">  <br>--}}
                &lt;input type=&quot;submit&quot; value=&quot;提交&quot; /&gt;
                &lt;/fieldset&gt;
            &lt;/form&gt;
            &lt;/body&gt;
            &lt;/html&gt;
</form></code></pre><h1 id="Session"><a href="#Session" class="headerlink" title="Session"></a><a id="Session"></a>Session</h1><pre><code>方式一:使用文件.(默认)
    .env文件中配置Session存储方式
        CACHE_DRIVER=file
        SESSION_DRIVER=file
        QUEUE_DRIVER=sync

方式二:使用数据库
    .env文件中配置Session存储方式
        CACHE_DRIVER=file
        SESSION_DRIVER=database
        QUEUE_DRIVER=sync
    使用PHPStorm自带的lerminal工具或者计算机命令行cmd定位到项目目录下.

    使用命令生成数据库表:
        php artisan session:table

        E:\ComTu_Design\PHP\Apache2.2\htdocs\firstPHPStorm\my_laravel&gt;php artisan session:table

        当输出 Migration created successfully!时 
        可查看到database/migrations目录下会新创建一个PHP文件类名为CreateSessionTable

        再输入 composer dump-autoload
            当输出 Generating autoload files 表示成功.

        再输入 php artisan migrate    
            当输出如下表示成功
            Migrated: 2015_11_02_092311_create_session_table

        查看数据库表多了一个sessions表
            里面有id , payload , last_activity 三个字段
        注: 执行php artisan migrate时有异常可查看&quot;我遇到的错误解决问题&quot;


        生成表之后就可以使用Session了`~增删改查都无需要人工控制.

控制器
    app/Http/Controlers/DemoSessionController.php
        &lt;?php namespace App\Http\Controllers;
        use App\Http\Controllers\Controller;
        use Illuminate\Support\Facades\Session;
        class DemoSessionController extends Controller{

            public function session(){
            //查看全部Session数据
            var_dump(Session::all());

            /*
             起初Session就有默认值
            _previous : 上一次请求的地址
            flash: 保存的数据
            old:历史数据
            new:新数据
            例:
             array:3 [▼
              &quot;_token&quot; =&gt; &quot;7jcZiP2wv0nIpxrA4KUqn9sBRaU7YXpcc8M0zrue&quot;
              &quot;_previous&quot; =&gt; array:1 [▼
                &quot;url&quot; =&gt; &quot;http://localhost/uploadFile&quot;
              ]
              &quot;flash&quot; =&gt; array:2 [▼
                &quot;old&quot; =&gt; []
                &quot;new&quot; =&gt; []
              ]
            ]
             */
            echo &apos;&lt;br&gt;&apos;; echo &apos;&lt;br&gt;&apos;;

            //增加/修改Session _ 方式一
            Session::put(&apos;username&apos;,&apos;comtu&apos;);

            //增加Session _ 方式二
            session([&apos;username&apos;=&gt;&apos;comtu1&apos;]);

            //获取值_不删除
            $username = Session::get(&apos;username&apos;);
            //获取值_后删除_只用一次
            $username = Session::pull(&apos;username&apos;);
            var_dump($username);
            echo &apos;&lt;br&gt;&apos;; echo &apos;&lt;br&gt;&apos;;

            //判断是否存在
            $bool = Session::has(&apos;username&apos;);
            var_dump($bool);

            //删除Session值
            $value = Session::forget(&apos;username&apos;);
            var_dump($value);
            }
        }

路由
    app/Http/routes.php    
        Route::any(&apos;session&apos;,&apos;DemoSessionController@session&apos;);
</code></pre><h1 id="表单验证"><a href="#表单验证" class="headerlink" title="表单验证"></a><a id="表单验证"></a>表单验证</h1><pre><code>需要引入use Request,Validator; 包
$validator = Validator::make(数据,规则,自定义错误信息);
$validator-&gt;fails();验证表单
$validator-&gt;errors();//获取错误信息

例:修改8.数据库中的Demo
    public function postAddPerson(){
    //存储提交数据到Session
    Request::flash(); //见9.请求

    //必填 required
    //长度 between:最小,最大
    //最小长度 min:4
    //最大长度 max:16
    //数字 numeric
    //唯一性 unique:表名 会自动查询表对应字段是否存在有当前值
    //检查值是否在table表中column字段中存在 exists:table,column 自动查询table表column字段是否包含值
    //更多配置 http://laravel-china.org/docs/5.0/validation

    //表单验证请求
    $rq = Request::all();
    $rules = [//规则
        &apos;name&apos; =&gt; &apos;required|between:4,16|unique:person&apos; ,
        &apos;age&apos; =&gt; &apos;required|numeric&apos;,
        &apos;sex&apos; =&gt; &apos;required|numeric&apos;,
        &apos;salary&apos; =&gt; &apos;required|numeric&apos;,
       &apos;occ_id&apos; =&gt; &apos;required|numeric|exists:occupation,occ_id&apos;,
        &apos;dep_id&apos; =&gt; &apos;required|numeric|exists:department,dep_id&apos;,
    ];
    $messages = [//自定义错误信息
        &apos;required&apos; =&gt; &apos;The :attribute field is required.&apos;,
        &apos;between&apos; =&gt; &apos;The :attribute must be between :min - :max.&apos;
    ];
    $validator = Validator::make($rq,$rules,$messages);//可三个参数
    //$validator = Validator::make($rq,$rules);//可两个参数

    if($validator-&gt;fails()){//表单验证
        $person = new Person();//重新封装历史数据
        $person-&gt;name = Request::old()[&apos;name&apos;];//表单验证失败,返回用户之前输入的信息
        $person-&gt;age = Request::old()[&apos;age&apos;];
        $person-&gt;sex = Request::old()[&apos;sex&apos;];
        $person-&gt;salary = Request::old()[&apos;salary&apos;];
        $person-&gt;occ_id = Request::old()[&apos;occ_id&apos;];
        $person-&gt;dep_id = Request::old()[&apos;dep_id&apos;];

        $data [&apos;person&apos;] = $person;
        $data[&apos;occupation&apos;] = Occupation::get();
        $data[&apos;department&apos;] = Department::all();
        //错误信息 Illuminate\Support\MessageBag 对象类型 head($validator-&gt;get(&apos;key&apos;))获取键值
        $data[&apos;validator&apos;] = $validator-&gt;errors();
        return view(&apos;demo.demo_add_update_database&apos;,$data);
    }

    $person = new Person();
    //增加数据方式2
    $person-&gt;name = Request::input(&apos;name&apos;, &apos;default&apos;);//获取Post请求的数据
    $person-&gt;age = Request::input(&apos;age&apos;, 20);
    $person-&gt;sex = Request::input(&apos;sex&apos;, 0);
    $person-&gt;salary = Request::input(&apos;salary&apos;, 1800);
    $person-&gt;occ_id = Request::input(&apos;occ_id&apos;);
    $person-&gt;dep_id = Request::input(&apos;dep_id&apos;);
    $person-&gt;save();
    return redirect(&apos;myDatabase/Demo&apos;);
    }
</code></pre><h1 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a><a id="中间件"></a>中间件</h1><pre><code>HTTP 中间件提供一个方便的机制来过滤进入应用程序的 HTTP 请求，
例如，Laravel 默认包含了一个中间件来检验用户身份验证，如果用户没有经过身份验证，
中间件会将用户导向登录页面，然而，如果用户通过身份验证，中间件将会允许这个请求进一步继续前进。

当然，除了身份验证之外，中间件也可以被用来执行各式各样的任务，CORS 中间件负责替所
有即将离开程序的响应加入适当的响应头，一个日志中间件可以记录所有传入应用程序的请求。 
Laravel 框架已经内置一些中间件，包括维护、身份验证、CSRF 保护，等等。
所有的中间件都位于 app/Http/Middleware 目录内。

使用步骤
    1.创建中间件
        使用命令: php artisan make:middleware AdminPrivilegeMiddleware
        在app/Http/Middleware文件夹中创建中间件文件
        如:AdminPrivilegeMiddleware.php
            &lt;?php
            namespace App\Http\Middleware;
            use Closure;
            use Illuminate\Support\Facades\Session;
            class AdminPrivilegeMiddleware
            {
                /**
                 * Handle an incoming request.
                 * @param  \Illuminate\Http\Request  $request
                 * @param  \Closure  $next
                 * @return mixed
                 */
                public function handle($request, Closure $next)
                {
                //权限认证
                $bool = Session::has(&apos;admin_user&apos;);
                if(!$bool)
                    return redirect(&apos;admin/privilege/login&apos;);
                return $next($request);
                }
            }
    2.注册中间件 
        在app/Http目录下的Kernel.php增加如下内容
         protected $routeMiddleware = [
            //注册中间件
            &apos;auth.admin&apos; =&gt; \App\Http\Middleware\AdminPrivilegeMiddleware::class,
         ];
    3.使用中间件
        在app/Http目录下的routes.php使用:
        //中间件,权限控制
        Route::group([&apos;middleware&apos; =&gt; &apos;auth.admin&apos;], function() {
            Route::get(&apos;admin/main/index&apos;,&apos;admin\MainController@index&apos;);
            Route::get(&apos;admin/categroy/index&apos;,&apos;admin\CategroyController@index&apos;);
        }
</code></pre><h1 id="哈希"><a href="#哈希" class="headerlink" title="哈希"></a><a id="哈希"></a>哈希</h1><pre><code>可用于加密用户的敏感信息或者密码
需要导入 use Illuminate\Support\Facades\Hash; 包
使用方法: 
    $password = &apos;123&apos;;
    $pass = Hash::make($password);//加密
    $password2 = &apos;123&apos;;
    $bool = Hash:check($pass,$password2);检查是否相同
</code></pre><h1 id="辅助函数"><a href="#辅助函数" class="headerlink" title="辅助函数"></a><a id="辅助函数"></a>辅助函数</h1><pre><code>array 数组相关

    head
        $arr = [1,2,3];
        $value = head($arr);//打印1 返回数组第一个元素

    last 
        $arr = [1,2,3];
        $value = last($arr);//打印3 返回数组第一个元素

    array_only
        $arr = [&apos;name&apos;=&gt;&apos;comtu&apos;,&apos;age&apos;=&gt;10,&apos;job&apos;=&gt;&apos;manager&apos;];
        $value = array_only($arr,[&apos;name&apos;,&apos;age&apos;]);//返回数组中指定的数据
        //打印 array(2) { [&quot;name&quot;]=&gt; string(5) &quot;comtu&quot; [&quot;age&quot;]=&gt; int(10) } 

    array_first //返回满足条件的第一条数据
        $arr = [10,20,30];
        $value = array_first($arr,function($key,$v){
            return $v &gt;10; 
        });
        //打印 20

    array_add
        $arr = [&apos;name&apos;=&gt;&apos;comtu&apos;,&apos;age&apos;=&gt;10];
        $value = array_add($arr,&apos;job&apos;,&apos;manager&apos;);//给数组增加字段 
        // 返回 [&apos;name&apos;=&gt;&apos;comtu&apos;,&apos;age&apos;=&gt;10,&apos;job&apos;=&gt;&apos;manager&apos;]

    array_set //修改数组中对应的值
        $arr = [&apos;start_time&apos;=&gt;&apos;2009-06-01&apos;,&apos;end_time&apos;=&gt;&apos;2014-11-30&apos;];
        array_set($rq,&apos;start_time&apos;,strtotime(Request::input(&apos;start_time&apos;)));  //strtotime时间转时间戳
        //返回 [&apos;start_time&apos;=&gt;1243814400,&apos;end_time&apos;=&gt;&apos;2014-11-30&apos;];;

    array_except
        $arr = [&apos;name&apos;=&gt;&apos;comtu&apos;,&apos;age&apos;=&gt;10,&apos;job&apos;=&gt;&apos;manager&apos;];
        $value = array_except($arr,&apos;job&apos;);//返回数组中除指定键后的数据 
        //返回 [&apos;name&apos;=&gt;&apos;comtu&apos;,&apos;age&apos;=&gt;10]

    array_flatten
        $arr = [
            &apos;a&apos; =&gt;1,
            &apos;b&apos; =&gt;[
                &apos;a&apos;=&gt;2,
                &apos;b&apos;=&gt;3
                ]
            ];
        $value = aray_flatten($arr);//返回$arr内的所有值 
        //返回 array(3) { [0]=&gt; int(1) [1]=&gt; int(2) [2]=&gt; int(3) } 

    array_where
        $arr = [&apos;name&apos; =&gt; &apos;comtu&apos;,&apos;age&apos;=&gt;18,&apos;job&apos;=&gt;&apos;manager&apos;];
        $value = array_where($arr,function($k,$v){
            return is_string($v);
        });//返回满足条件的新数组 返回全是String类型的数据
        //返回 [&apos;name&apos; =&gt; &apos;comtu&apos;,&apos;job&apos;=&gt;&apos;manager&apos;]

Path 辅助函数
    echo app_path();// 项目绝对路径 项目绝对路径
        E:\ComTu_Design\PHP\Apache2.2\htdocs\firstPHPStorm\my_laravel\app

    echo config_path(); 项目下的配置目录的绝对路径
        E:\ComTu_Design\PHP\Apache2.2\htdocs\firstPHPStorm\my_laravel\config

    echo public_path(); 项目下的public目录的绝对路径
        E:\ComTu_Design\PHP\Apache2.2\htdocs\firstPHPStorm\my_laravel\public

    echo storage_path(); 项目下的storage目录的绝对路径
        E:\ComTu_Design\PHP\Apache2.2\htdocs\firstPHPStorm\my_laravel\storage


字符串 辅助函数
    str_plural 单词单数变复数
        例如 $value = str_plural(&apos;apple&apos;); //返回apples
             $value = str_plural(&apos;sheep&apos;);// 返回sheep 
             $value = str_plural(&apos;ability&apos;);// 返回abilities

    starts_with
        //字符串是否是与指定的内容开头
        var_dump( starts_with(&apos;abcd&apos;,&apos;ab&apos;));//返回true

    ends_with
        //字符串是否是与指定的内容结束
        var_dump( ends_with(&apos;abcd&apos;,&apos;b&apos;));//返回false

    camel_case
        //将字符串替换成驼峰命名法
        echo camel_case(&apos;hello_world&apos;);//返回helloWorld

    class_basename
        //返回 命名空间的类名
        echo class_basename(&apos;App\Controller\DemoDataBaseController&apos;);//返回DemoDataBaseController

    str_limit
        //限制字符串的长度_返回指定长度的字符串
        echo str_limit(&apos;abcdefg&apos;,3);//返回abc... 后面有省略号

    str_is
        //判断字符串是否满足条件 是否是与ab开头e结尾_参数一是条件,参数二是判断的值
        var_dump(str_is(&apos;ab*e&apos;,&apos;abcde&apos;)); //返回true
</code></pre><h1 id="在-Laravel-中使用图片处理库-Integration-Image"><a href="#在-Laravel-中使用图片处理库-Integration-Image" class="headerlink" title="在 Laravel 中使用图片处理库 Integration/Image"></a><a id="图片处理库Integration/Image"></a>在 Laravel 中使用图片处理库 Integration/Image</h1><pre><code>系统需求

     PHP &gt;= 5.3
     Fileinfo Extension
     GD Library (&gt;=2.0) … or …
     Imagick PHP extension (&gt;=6.5.7)

安装部署 Integration/image

    在 composer.json [require] 节增加&quot;&quot;intervention/image&quot;: &quot;2.*&quot;&quot;，之后执行 composer update 我当时下载的是2.3.2

    如果出现错误信息: (PHP版本5.5.28)
            E:\ComTu_Design\PHP\Apache2.2\htdocs\firstPHPStorm\myLaravelShop&gt;composer update
            &gt; php artisan clear-compiled
            Loading composer repositories with package information
            Updating dependencies (including require-dev)
            Your requirements could not be resolved to an installable set of packages.

              Problem 1
                - Installation request for intervention/image 2.0.17 -&gt; 
                    satisfiable by intervention/image[2.0.17].
                - intervention/image 2.0.17 requires ext-fileinfo * -&gt; 
                    the requested PHP extension fileinfo is missing from your system.
        解决方法:
            找到PHP环境目录 --&gt; 打开 php.ini 文件 找到 ;extension=php_fileinfo.dll (PHP5.5.28-nts 862行) 
            去除前面的;号~~重新运行即可. 会在后台下载,等待.

Laravel 配置

    安装部署 Integration/image 完成后，打开配置文件 config/app.php 在相应位置添加代码，
    然后 Image 类就能自动加载并可供使用了。其功能强大到可以处理你的几乎所有图片处理需求。
        //服务提供器 Laravel 5.1.23     在 providers  中配置
         Intervention\Image\ImageServiceProvider::class,

        //别名配置 Laravel 5.1.23  在 aliases 中配置 
        &apos;Image&apos;     =&gt; Intervention\Image\Facades\Image::class,

配置设置
    默认情况下， Integration/Image 使用PHP的GD库扩展。
    如果你想切换到 imagick，你可以使用 php artisan 创建一个配置文件以添加相应的配置。
    $ php artisan config:publish intervention/imag

基本使用

    这里列出几个基本功能，更详细使用说明请查看相关接口文档。
    文档地址: http://image.intervention.io/  墙

        Demo
        //1、显示一张图片
        Route::get(&apos;imageRead&apos;,function(){
            $img = Image::make(public_path().&apos;/uploads/43195301.jpg&apos;);//读取图片
            return $img-&gt;response();//返回图片资源在浏览器中显示
        });

        //2、创建缩略图
        Route::get(&apos;imageThumbnail&apos;,function(){
            if (!file_exists(public_path().&apos;/uploads/thumbnail&apos;)){ //创建文件夹
            mkdir (public_path().&quot;/uploads/thumbnail&quot;);
            }

            $rawFilePath = public_path().&apos;/uploads/43195301.jpg&apos;;
            $thumbnailFilePath = public_path().&apos;/uploads/thumbnail/&apos;.uniqid().&apos;.jpg&apos;;

            //生成缩略图
            $img = Image::make($rawFilePath);//读取图片文件
            $img-&gt;resize(120,120);//缩略图大小 宽/高
            $img-&gt;save($thumbnailFilePath);//需要保存在已有的目录中
            echo $rawFilePath.&apos;生成缩略图到&apos;.$thumbnailFilePath;
        });

        //3、绘制一张图片
        Route::get(&apos;imageCanvas&apos;,function(){
            $img = Image::canvas(800, 600, &apos;#ccc&apos;);
            return $img-&gt;response();
        });

        //4.插入一个水印
        Route::get(&apos;imageInsert&apos;,function(){
            $rawFilePath = public_path().&apos;/uploads/43195301.jpg&apos;;
            $watermark = public_path().&apos;/uploads/563b24c067472.jpg&apos;;//水印
            //top-left (default)
            //top
            //top-right
            //left
            //center
            //right
            //bottom-left
            //bottom
            //bottom-right
            // $img-&gt;insert($watermark, &apos;bottom-right&apos;, 10, 10);//其它位置
            // $img-&gt;insert($watermark, &apos;center&apos;);//中间
            $img = Image::make($rawFilePath)-&gt;resize(800, 600)-&gt;insert($watermark);//打水印,默认左上角

            return $img-&gt;response();
        });


    如果运行时页面中出现如下错误:
        NotSupportedException in Driver.php line 18:
        GD Library extension not available with this PHP installation.
        in Driver.php line 18
        at Driver-&gt;__construct() in ImageManager.php line 107
        at ImageManager-&gt;createDriver() in ImageManager.php line 50
        at ImageManager-&gt;make(&apos;/public/uploads/43195301.jpg&apos;) in Facade.php line 214
        ....
    解决方案
        开启PHP的GD功能
        找到PHP环境目录 --&gt; 打开 php.ini (PHP5.5.28-nts 863行) 文件 
        找到 ;extension=php_gd2.dll 去除前面的;号~~重新启动服务运行即可. 
</code></pre><h1 id="我遇到的错误"><a href="#我遇到的错误" class="headerlink" title="我遇到的错误"></a><a id="我遇到的错误"></a>我遇到的错误</h1><pre><code>链接数据库时异常.
    //路由中,尝试连接数据库
    Route::get(&apos;myDatabase&apos;,function(){
        $name = DB::connection()-&gt;getDatabaseName();
        echo $name; //打印出 数据库名 my_laravel 表示成功
    });

    PDOException in Connector.php line 47:
    could not find driver
    in Connector.php line 47
    at PDO-&gt;__construct(&apos;mysql:host=localhost;dbname=my_laravel&apos;,
    &apos;root&apos;, &apos;root&apos;, array(&apos;0&apos;, &apos;2&apos;, &apos;0&apos;, false, false)) in Connector.php line 47
    .....

    解决办法:
    php环境中找到 php.ini文件并找到 ;extension=php_pdo_mysql.dll 
    并去除前面的;号.然后重启服务器.如apache 或者 关闭服务重新启动服务 php -S localhost:80 -t my_laravel\public

Session生成数据库表异常
    错误原因1.可能存在冲突的表原因.
        database/migrations 目录下的文件是需要生成的表.
        如果出现错误警告,可查看当前目录下的文件是否是自己需求要创建的表.
        如果里面存在冲突的表,如我当时有两个users表
        查打开查看文件是否是自己的内容.如果不是.~~可删除文件,需要注意的是
        删除后需要在    my_laravel/vendor/composer/autoload_classmap.php 
        文件中找到相同的一条记录一并删除重新执行即可.

还有遇到的一些错误见功能模块,有解决方案
</code></pre><h1 id="artisan命令"><a href="#artisan命令" class="headerlink" title="artisan命令"></a><a id="artisan命令"></a>artisan命令</h1><pre><code>谨慎操作还原回清静 php artisan fresh

创建控制器
    php artisan make:controller MyController

创建model
    php artisan make:model User

查看当前所有路由列表
    php artisan route:list

一整个程序停止解析(使用场景如,网站遇到攻击,网站需要维护等)
    配置后访问网站的所有地址都会被跳转到Beright back
    php artisan down 
    php artisan up

生成Session数据库表
    php artisan session:table  //1
    composer dump-autoload     //2
    php artisan migrate        //3

创建中间件
    php artisan make:middleware MyMiddleware
</code></pre><p>英文文档<br><a href="http://laravel.com/docs/5.1" target="_blank" rel="external">http://laravel.com/docs/5.1</a>   </p>
<p>中文文档:<br><a href="http://www.golaravel.com/" target="_blank" rel="external">http://www.golaravel.com/</a><br><a href="http://laravel-china.org/docs/5.0/middleware" target="_blank" rel="external">http://laravel-china.org/docs/5.0/middleware</a><br><a href="http://www.golaravel.com/post/install-and-run-laravel-5-x-on-windows/" target="_blank" rel="external">http://www.golaravel.com/post/install-and-run-laravel-5-x-on-windows/</a>   </p>
<h1 id="Demo下载"><a href="#Demo下载" class="headerlink" title="Demo下载"></a><a id="Demo"></a>Demo下载</h1><p>本博文的案例Demo下载地址如下:</p>
<p><a href="/res/file/blog/2015/10/10/PHP_Laravel/laravel-v5.0.22_Demo.rar">本文案例Demo</a></p>
<p><a href="/res/file/blog/2015/10/10/PHP_Laravel/myLaravelShop_Demo.rar">本文案例Demo_购物商场</a></p>
<p>刚学PHP的两个框架Laravel与CI,个人对这两个框架的感觉如下~</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:left">Laravel</th>
<th style="text-align:right">Codeigniter</th>
</tr>
</thead>
<tbody>
<tr>
<td>开发效率</td>
<td style="text-align:left">★★★★</td>
<td style="text-align:right">★★★</td>
</tr>
<tr>
<td>运行效率</td>
<td style="text-align:left">★★★</td>
<td style="text-align:right">★★★★</td>
</tr>
<tr>
<td>学习成本</td>
<td style="text-align:left">★★☆</td>
<td style="text-align:right">★</td>
</tr>
</tbody>
</table>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/PHP/" rel="tag">#PHP</a>
          
            <a href="/tags/Laravel/" rel="tag">#Laravel</a>
          
            <a href="/tags/artisan/" rel="tag">#artisan</a>
          
            <a href="/tags/Integration-Image/" rel="tag">#Integration/Image</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/09/10/PHP_codeigniter.html" rel="next" title="PHP学习笔记-CI框架">
                <i class="fa fa-chevron-left"></i> PHP学习笔记-CI框架
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/11/01/android_proguard.html" rel="prev" title="Android混淆">
                Android混淆 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="weekly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="/2015/10/10/PHP_Laravel.html"
           data-title="PHP学习笔记-Laravel框架" data-url="http://comtu.github.com//2015/10/10/PHP_Laravel.html">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/res/img/icon.jpg"
               alt="Comtu" />
          <p class="site-author-name" itemprop="name">Comtu</p>
          <p class="site-description motion-element" itemprop="description">The time is passing</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">30</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">95</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/comtu" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/comtu" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#安装Laravel"><span class="nav-number">1.</span> <span class="nav-text">安装Laravel</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Laravel目录结构"><span class="nav-number">2.</span> <span class="nav-text">Laravel目录结构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#路由"><span class="nav-number">3.</span> <span class="nav-text">路由</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#控制器-Controller"><span class="nav-number">4.</span> <span class="nav-text">控制器(Controller)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#视图-Views"><span class="nav-number">5.</span> <span class="nav-text">视图(Views)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#模型-model"><span class="nav-number">6.</span> <span class="nav-text">模型(model)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#环境与部署"><span class="nav-number">7.</span> <span class="nav-text">环境与部署</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据库"><span class="nav-number">8.</span> <span class="nav-text">数据库</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#请求"><span class="nav-number">9.</span> <span class="nav-text">请求</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Session"><span class="nav-number">10.</span> <span class="nav-text">Session</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#表单验证"><span class="nav-number">11.</span> <span class="nav-text">表单验证</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#中间件"><span class="nav-number">12.</span> <span class="nav-text">中间件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#哈希"><span class="nav-number">13.</span> <span class="nav-text">哈希</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#辅助函数"><span class="nav-number">14.</span> <span class="nav-text">辅助函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在-Laravel-中使用图片处理库-Integration-Image"><span class="nav-number">15.</span> <span class="nav-text">在 Laravel 中使用图片处理库 Integration/Image</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#我遇到的错误"><span class="nav-number">16.</span> <span class="nav-text">我遇到的错误</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#artisan命令"><span class="nav-number">17.</span> <span class="nav-text">artisan命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Demo下载"><span class="nav-number">18.</span> <span class="nav-text">Demo下载</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Comtu</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"comtu"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="/js/src/hook-duoshuo.js"></script>
    
  






  
  
  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("feqhc8WOUwoueUx9gkNO8kIq-gzGzoHsz", "3Igep5lfuSGHiGQJB0PFjICO");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
